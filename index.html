<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LxghtBlvee</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
   
    <button class="theme-fab" id="theme-btn" aria-label="Toggle theme">üåô</button>

    <!-- NAV -->
    <header class="nav">
      <div class="nav-inner">
        <a class="brand" href="#top">LxghtBlvee</a>

        <nav class="nav-links">
          <a href="#about">About</a>
          <a href="#projects">Projects</a>
          <a href="#music">Music</a>
          <a href="#activity">Activity</a>
          <a href="#contact">Contact</a>
        </nav>
      </div>
    </header>

    <!-- HERO -->
    <main class="hero" id="top">
      <div class="bg" id="bg"></div>
      <div class="overlay"></div>

      <div class="content">
        <h1>
          Hiya, I'm
          <span class="accent" id="type-target"></span><span class="cursor">|</span>
        </h1>

        <div class="icons">
          <a
            class="icon-btn"
            href="https://www.roblox.com/users/9519944913/profile"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Roblox"
          >
            <img src="assets/roblox.svg" alt="Roblox" class="icon-img" />
          </a>

          <a
            class="icon-btn"
            href="https://github.com/LxghtBlvee"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
          >
            <img src="assets/github.svg" alt="GitHub" class="icon-img" />
          </a>
        </div>
      </div>
    </main>


    <span class="presence" id="presence" aria-label="Presence status" title="Offline">‚óè</span>

    <!-- ABOUT -->
    <section class="section" id="about">
      <div class="wrap">
        <h2>About Me</h2>
        <p>
          üëã I‚Äôm LxghtBlvee - a developer focused on Discord automation, moderation tooling,
          and systems that connect communities with Roblox experiences. You can find me playing some of my favorite games
          or working on a project of mine.
        </p>

        <div class="pills">
          <span class="pill">TypeScript</span>
          <span class="pill">Node.js</span>
          <span class="pill">NestJS</span>
          <span class="pill">Discord.js</span>
          <span class="pill">MongoDB</span>
          <span class="pill">Roblox APIs</span>
        </div>
      </div>
    </section>

    <!-- PROJECTS -->
    <section class="section" id="projects">
      <div class="wrap">
        <h2>Projects</h2>

        <div class="cards">
          <article class="card">
            <div class="card-top">
              <h3>Helix Bot Contributions</h3>
              <div class="tags">
                <span class="tag">NestJS</span><span class="tag">Discord.js</span><span class="tag">MongoDB</span>
              </div>
            </div>
            <p>Infraction history improvements, safer typing, cleaner interaction flow.</p>
            <div class="card-actions">
              <a class="btn" href="https://github.com/LxghtBlvee" target="_blank" rel="noopener noreferrer">View GitHub</a>
            </div>
          </article>

          <article class="card">
            <div class="card-top">
              <h3>Echelon Bot Contributions</h3>
              <div class="tags">
                <span class="tag">Node.js</span><span class="tag">APIs</span>
              </div>
            </div>
            <p>Backend service client work + improvements to automation tooling.</p>
            <div class="card-actions">
              <a class="btn" href="https://github.com/LxghtBlvee" target="_blank" rel="noopener noreferrer">View GitHub</a>
            </div>
          </article>

          <article class="card">
            <div class="card-top">
              <h3>Portfolio Site</h3>
              <div class="tags">
                <span class="tag">HTML</span><span class="tag">CSS</span><span class="tag">Cloudflare</span>
              </div>
            </div>
            <p>Hero background, typewriter name, Now Listening powered by Last.fm.</p>
            <div class="card-actions">
              <a class="btn" href="#top">Back to top</a>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- MUSIC -->
    <section class="section" id="music">
      <div class="wrap">
        <h2>Now Listening</h2>

        <div class="now-card" id="now-card">
          <div class="now-art" id="now-art"></div>

          <div class="now-meta">
            <div class="now-badge" id="now-badge" hidden>
              <span class="dot"></span> Listening now
            </div>

            <div class="now-title" id="now-title">Loading‚Ä¶</div>
            <div class="now-artist" id="now-artist"></div>
          </div>

          <a
            class="now-link"
            id="now-link"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Open on Last.fm"
          >
            ‚Üó
          </a>
        </div>
      </div>
    </section>

    <!-- ACTIVITY -->
    <section class="section" id="activity">
      <div class="wrap">
        <h2>Activity</h2>

  
        <div class="activity-list" id="activity-skeleton">
          <div class="activity-item skeleton"></div>
          <div class="activity-item skeleton"></div>
          <div class="activity-item skeleton"></div>
        </div>

        <div class="activity-error" id="activity-error" hidden></div>

        <div class="activity-list" id="activity-list" hidden></div>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="section" id="contact">
      <div class="wrap">
        <h2>Contact</h2>
        <p>
          Find me on
          <a href="https://github.com/LxghtBlvee" target="_blank" rel="noopener noreferrer">GitHub</a>
          and
          <a href="https://www.roblox.com/users/9519944913/profile" target="_blank" rel="noopener noreferrer">Roblox</a>.
        </p>
      </div>
    </section>

    <script>

      // Typewriter

      const target = document.getElementById("type-target");
      const names = ["LxghtBlvee", "Intel_RookieAlt", "Damian"];
      let nameIndex = 0;

      const typeSpeed = 150;
      const deleteSpeed = 95;
      const holdTime = 4000;
      const pauseBetween = 600;

      function typeText(text, i = 0) {
        if (i <= text.length) {
          target.textContent = text.slice(0, i);
          setTimeout(() => typeText(text, i + 1), typeSpeed);
        } else {
          setTimeout(() => deleteText(text, text.length), holdTime);
        }
      }

      function deleteText(text, i) {
        if (i >= 0) {
          target.textContent = text.slice(0, i);
          setTimeout(() => deleteText(text, i - 1), deleteSpeed);
        } else {
          nameIndex = (nameIndex + 1) % names.length;
          setTimeout(() => typeText(names[nameIndex], 0), pauseBetween);
        }
      }

      typeText(names[nameIndex], 0);


      // API (Feed)
      const FEED_URL = "https://lxghtblvee-api.dickeydamian.workers.dev/feed";

      let lastFeedSig = "";

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, (c) => ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        }[c]));
      }

      function safeCssUrl(url) {
        if (!url) return "";
        // basic safety: only allow http(s)
        if (!/^https?:\/\//i.test(url)) return "";
        return url;
      }

      function renderPresence(p) {
        const el = document.getElementById("presence");
        if (!el) return;

        const state =
          p?.music === "listening"
            ? "listening"
            : (p?.roblox === "online" ? "online" : "offline");

        el.dataset.state = state;
        el.title =
          state === "listening"
            ? "Listening now"
            : (state === "online" ? "Online" : "Offline");
      }

      function renderActivity(items) {
        const list = document.getElementById("activity-list");
        if (!list) return;

        list.innerHTML = "";

        for (const it of items.slice(0, 6)) {
          const a = document.createElement("a");
          a.className = "activity-item";
          a.href = it.url || "#";
          a.target = "_blank";
          a.rel = "noopener noreferrer";

          const img = safeCssUrl(it.image);

          a.innerHTML = `
            <div class="activity-left">
              <div class="activity-img" ${img ? `style="background-image:url('${img}')"` : ""}></div>
              <div class="activity-text">
                <div class="activity-title">${escapeHtml(it.title || "")}</div>
                <div class="activity-sub">${escapeHtml(it.subtitle || "")}</div>
              </div>
            </div>
            <div class="activity-arrow">‚Üó</div>
          `;

          list.appendChild(a);
        }
      }

      function renderMusicFromPresence(p) {
        const art = document.getElementById("now-art");
        const title = document.getElementById("now-title");
        const artist = document.getElementById("now-artist");
        const link = document.getElementById("now-link");
        const badge = document.getElementById("now-badge");
        if (!title || !artist || !link || !badge || !art) return;

      }

      function renderNowCardFromItems(items) {
        const art = document.getElementById("now-art");
        const title = document.getElementById("now-title");
        const artist = document.getElementById("now-artist");
        const link = document.getElementById("now-link");
        const badge = document.getElementById("now-badge");
        if (!title || !artist || !link || !badge || !art) return;

        const musicItem = items.find((x) => x.type === "music_now") || items.find((x) => x.type === "music_last");

        if (!musicItem) {
          badge.hidden = true;
          title.textContent = "Nothing playing";
          artist.textContent = "";
          art.style.backgroundImage = "none";
          link.href = "https://www.last.fm/user/LxghtBlvee";
          return;
        }

        const isNow = musicItem.type === "music_now";

        badge.hidden = !isNow;

        title.textContent = isNow ? (musicItem.title || "Listening‚Ä¶") : (musicItem.title || "Last played");
        artist.textContent = musicItem.subtitle || "";

        link.href = musicItem.url || "https://www.last.fm/user/LxghtBlvee";

        const img = safeCssUrl(musicItem.image);
        art.style.backgroundImage = img ? `url("${img}")` : "none";
      }

      async function updateFeed(force = false) {
        const skel = document.getElementById("activity-skeleton");
        const list = document.getElementById("activity-list");
        const err = document.getElementById("activity-error");

        try {
          const res = await fetch(FEED_URL, { cache: "no-store" });
          if (!res.ok) throw new Error(`Feed HTTP ${res.status}`);
          const data = await res.json();

          const items = Array.isArray(data?.items) ? data.items : [];
          const sig = JSON.stringify(items.map(i => [i.type, i.title, i.subtitle, i.url, i.image, i.ts]));

          if (!force && sig === lastFeedSig) return;
          lastFeedSig = sig;

          renderPresence(data?.presence);
          renderNowCardFromItems(items);
          renderActivity(items);

          // show content only on success
          if (skel) skel.hidden = true;
          if (list) list.hidden = false;
          if (err) err.hidden = true;
        } catch (e) {
          // keep skeleton if first load fails
          if (err) {
            err.hidden = false;
            err.textContent = "Couldn't load activity right now.";
          }
        }
      }

      updateFeed(true);
      setInterval(() => updateFeed(false), 5000);

      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) updateFeed(true);
      });


      // Active nav link highlight

      const sectionIds = ["about", "projects", "music", "activity", "contact"];
      const navLinks = Array.from(document.querySelectorAll(".nav-links a"));

      const setActive = (id) => {
        navLinks.forEach((a) =>
          a.classList.toggle("active", a.getAttribute("href") === `#${id}`)
        );
      };

      const observer = new IntersectionObserver(
        (entries) => {
          const visible = entries
            .filter((e) => e.isIntersecting)
            .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
          if (visible) setActive(visible.target.id);
        },
        { threshold: [0.25, 0.4, 0.6] }
      );

      sectionIds.forEach((id) => {
        const el = document.getElementById(id);
        if (el) observer.observe(el);
      });

      // Theme toggle

      const themeBtn = document.getElementById("theme-btn");
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark") document.body.classList.add("dark");
      if (themeBtn) themeBtn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";

      themeBtn?.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        const isDark = document.body.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        themeBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      });


      // Static Background + parallax

      const bg = document.getElementById("bg");
      bg.style.backgroundImage = `url("assets/city.webp")`;

      window.addEventListener("mousemove", (e) => {
        const hero = document.querySelector(".hero");
        if (!hero) return;
        const r = hero.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;
        bg.style.transform = `translate(${x * 8}px, ${y * 8}px) scale(1.02)`;
      });
    </script>
  </body>
</html>
